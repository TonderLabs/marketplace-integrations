<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: integrationMapper.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: integrationMapper.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
var __awaiter = (this &amp;&amp; this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.IntegrationMapper = exports.handleWebhook = exports.integrationFromWebhookPayload = exports.getIntegration = void 0;
const integrations_1 = require("./integrations");
/**
 * Get an integration instance from its key.
 * @param integrationKey The integration key.
 * @returns The integration.
 * @throws {Error} If the integration does not exist.
 */
const getIntegration = (integrationKey) => {
    const integration = integrations_1.integrations[integrationKey];
    if (!integration) {
        throw new Error(`Integration ${integrationKey} not found`);
    }
    return integration;
};
exports.getIntegration = getIntegration;
/**
 * Find an integration instance that can handle a webhook payload.
 * @param payload The webhook payload.
 * @param config The configuration.
 * @returns The integration instance or undefined if not found.
 */
const integrationFromWebhookPayload = (payload, config) => {
    let integration;
    Object.keys(integrations_1.integrations).forEach((implName) => {
        const integrationInstance = new integrations_1.integrations[implName].handler(config);
        if (integrationInstance.validateWebhookPayload(payload)) {
            integration = integrationInstance;
        }
    });
    return integration;
};
exports.integrationFromWebhookPayload = integrationFromWebhookPayload;
/**
 * Handle a webhook.
 * @param payload The webhook payload.
 * @param config The configuration.
 * @returns A promise that resolves to the data response.
 * @throws {Error} If the integration does not exist or cannot handle the
 * webhook payload.
 */
const handleWebhook = (payload, config) => __awaiter(void 0, void 0, void 0, function* () {
    const integrationInstance = (0, exports.integrationFromWebhookPayload)(payload, config);
    if (!integrationInstance) {
        throw new Error("Integration not found");
    }
    return integrationInstance.handleWebhook(payload);
});
exports.handleWebhook = handleWebhook;
/**
 * A class that maps integration keys to their handlers.
 */
class IntegrationMapper {
    /**
     * Constructor.
     * @param config The configuration.
     */
    constructor(config) {
        this.config = config;
    }
    /**
     * Get the asset data with optional filters.
     * @param integrationKey The integration key.
     * @param pagination The pagination options.
     * @param requestQueryParams Optional query parameters from the request.
     * @returns A promise that resolves to the asset data and any supported
     * query parameters.
     * @throws {Error} If the integration does not exist.
     */
    getData(integrationKey, pagination, requestQueryParams) {
        const integration = (0, exports.getIntegration)(integrationKey);
        const integrationInstance = new integration.handler(this.config);
        return integrationInstance.getAssetData(pagination, requestQueryParams);
    }
    /**
     * Submit data to the asset provider.
     * @param integrationKey The integration key.
     * @param data The data to submit.
     * @returns A promise that resolves to the data response.
     * @throws {Error} If the integration does not exist.
     */
    submitData(integrationKey, data) {
        const integration = (0, exports.getIntegration)(integrationKey);
        return new integration.handler(this.config).submitData(data);
    }
    /**
     * Get the list of integrations.
     * @returns The list of integrations.
     */
    getIntegrations() {
        return Object.keys(integrations_1.integrations).map((integrationKey) => {
            const key = integrationKey;
            return Object.assign(Object.assign({}, integrations_1.integrations[key]), { key, handler: "handler" });
        });
    }
    /**
     * Handle a webhook.
     * @param payload The webhook payload.
     * @returns A promise that resolves to the data response.
     * @throws {Error} If the integration does not exist or cannot handle the
     * webhook payload.
     */
    handleWebhook(payload) {
        return __awaiter(this, void 0, void 0, function* () {
            return (0, exports.handleWebhook)(payload, this.config);
        });
    }
}
exports.IntegrationMapper = IntegrationMapper;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Integration.html">Integration</a></li><li><a href="IntegrationMapper.html">IntegrationMapper</a></li></ul><h3>Global</h3><ul><li><a href="global.html#FieldInputType">FieldInputType</a></li><li><a href="global.html#PriceDenominationType">PriceDenominationType</a></li><li><a href="global.html#getIntegration">getIntegration</a></li><li><a href="global.html#handleWebhook">handleWebhook</a></li><li><a href="global.html#integrationFromWebhookPayload">integrationFromWebhookPayload</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sun Apr 21 2024 08:17:05 GMT+0100 (West Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
